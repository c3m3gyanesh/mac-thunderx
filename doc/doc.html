<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  
  <style type="text/css">
  code
  {
  	color: blue;
  
    	font-family:monospace,monospace;
    	font-size: 1em;
  }
  
  code.gray
  {
  	color: gray;
    	font-family:serif;
  
      white-space: pre-wrap;       /* CSS 3 */
      white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
      white-space: -pre-wrap;      /* Opera 4-6 */
      white-space: -o-pre-wrap;    /* Opera 7 */
      word-wrap: break-word;       /* Internet Explorer 5.5+ */
  }
  
  pre.sourceCode
  {
    	font-family:monospace,monospace;
    	font-size: 1em;
  
  	margin-left: 3em;
  	padding: 0.5em;
  
  	border: 0.1em green solid !important;
  }
  </style>
</head>
<body>
<h1 id="required-software">Required software</h1>
<ul>
<li><a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox 5.0.6</a></li>
<li><a href="http://dpdk.org/download">DPDK 2.1.0</a></li>
<li><a href="http://www.linuxmint.com/edition.php?id=192">Linux Mint 17.2</a></li>
</ul>
<p>Similar software (e.g. other Linux distributions) and older versions (e.g. v4 of VirtualBox) will probably work, too.</p>
<h1 id="installation">Installation</h1>
<p>This description is applicable to both Windows and Linux hosts except where noted.</p>
<ol style="list-style-type: decimal">
<li>Make a VirtualBox virtual machine, and install Linux on it.</li>
<li>Setup the virtual machine environment
<ol style="list-style-type: decimal">
<li><code>VirtualBox-&gt;File-&gt;Preferences-&gt;Network-&gt;Host-only Networks</code>, add three adapters</li>
<li><code>(your virtual machine)-&gt;Settings-&gt;System-&gt;Processor</code>, set at least two CPUs.</li>
<li><code>(your virtual machine)-&gt;Settings-&gt;System-&gt;Network</code>, enable <code>Adapter 2</code>, <code>Adapter 3</code> and <code>Adapter 4</code>, and for each of them,
<ol style="list-style-type: lower-alpha">
<li>Under <code>Advanced</code>, set <code>Adapter Type</code> to <code>Intel PRO/1000 MT Server (82545EM)</code></li>
<li>Under <code>Attached to</code>, set <code>Host-only Adapter</code>, and <code>Name</code> to those of the adapters</li>
</ol></li>
</ol></li>
</ol>
<h2 id="configuration-of-the-guest-system">Configuration of the guest system</h2>
<ol style="list-style-type: decimal">
<li>Install necessary/useful Linux packages: <code>sudo aptitude install g++-multilib libvirt-dev python-setuptools clang-format-3.6 libpcap-dev pandoc subversion git</code></li>
<li>Setup DPDK
<ol style="list-style-type: decimal">
<li>setup exports
<ul>
<li>e.g. you can insert the below code into <code>~/.bashrc</code></li>
<li>the scripts use the following variables (all have sensible defaults)
<ul>
<li><code>ARCH</code>: the target architecture</li>
<li><code>MAKE_CMD</code>: the make command to use</li>
<li><code>P4DPDK_OPTS</code>: the EAL options that are given to the DPDK program
<ul>
<li><code>${P4DPDK_TRUNK}/scripts/set_opts_*</code> are some handy scripts, the following example uses one of them</li>
<li><code>set_opts_default</code> gives you a performant DPDK environment, <code>_nohuge</code> is a debug option that doesn’t use hugefiles, and <code>_terse</code> suppresses output</li>
</ul></li>
</ul></li>
</ul>
<pre><code>export RTE_SDK=insert/your/path/to/dpdk/here
export RTE_TARGET=x86_64-native-linuxapp-gcc

export P4DPDK_TRUNK=insert/your/path/to/p4dpdk/trunk/here

export MAKE_CMD=${P4DPDK_TRUNK}/scripts/colorized-make.sh
. ${P4DPDK_TRUNK}/scripts/set_opts_nohuge_terse.sh</code></pre></li>
<li>run <code>${P4DPDK_TRUNK}/scripts/guest_preinstall_run_once.sh</code></li>
</ol></li>
<li>Setup P4
<ol style="list-style-type: decimal">
<li><code>git clone https://github.com/p4lang/p4-hlir</code></li>
<li>inside the just created <code>p4-hlir</code> directory, run <code>sudo python setup.py install</code></li>
</ol></li>
</ol>
<h3 id="steps-at-the-start-of-the-day">Steps at the start of the day</h3>
<p>Each time before you start working, you’ll have to prepare your system. Run <code>${P4DPDK_TRUNK}/scripts/guest_preinstall_run_once.sh</code>, which will configure your system as needed.</p>
<p>These settings are cleared when you turn off your machine, or you can use <code>${P4DPDK_TRUNK}/scripts/guest_dpdk_off.sh</code> to explicitly clean up after you have run your DPDK programs.</p>
<h1 id="trying-dpdk-examples">Trying DPDK Examples</h1>
<ol style="list-style-type: decimal">
<li>In <code>$RTE_SDK</code>, run <code>sudo make examples -j16 T=x86_64-native-linuxapp-gcc</code></li>
<li>Run <code>${P4DPDK_TRUNK}/scripts/dpdk_example_bridge.sh</code>
<ul>
<li>it will run a bridge, and feed it some data (from the guest, through Adapter 3)</li>
</ul></li>
<li>Run <code>${P4DPDK_TRUNK}/scripts/dpdk_example_l2fwd.sh</code>
<ul>
<li>it will display a “Port statistics” table</li>
</ul></li>
<li>Run <code>${P4DPDK_TRUNK}/scripts/dpdk_example_l3fwd.sh</code>
<ul>
<li>it will start and not fail</li>
<li>it should particularly not show any <code>err=-22</code> error message</li>
</ul></li>
</ol>
<p>TODO describe how to send packets that the examples can get and handle</p>
<h1 id="running-the-p4-example">Running the P4 example</h1>
<ol style="list-style-type: decimal">
<li>go into the <code>trunk</code> directory</li>
<li>run <code>./test_dpdk1.sh</code>
<ul>
<li>it executes <code>make</code></li>
<li>it executes the built program as root, with appropriate parameters</li>
</ul></li>
</ol>
<p>TODO make a tester that - runs the program - sends packets to the emulated ports - collects the forwarded packets - checks if port forwarding is working all right</p>
<p>NOTE: <code>test_pcap1.sh</code> doesn’t work temporarily, as it is not up to date</p>
<h1 id="the-structure-of-the-compiler">The structure of the compiler</h1>
<p>In the following, <code>$ARCH</code> refers to one of the supported architectures, e.g. <code>pcap</code> or <code>dpdk</code>.</p>
<ul>
<li><code>src/</code>: the compiler and its utilities</li>
<li><code>src/hardware_indep/</code>: code generators for hardware independent parts
<ul>
<li><code>src/hardware_indep/parser</code>: code generator for the packet parser</li>
</ul></li>
<li><code>src/hardware_dep/$ARCH</code>: the hardware dependent parts
<ul>
<li><code>src/hardware_dep/$ARCH/includes</code>: headers</li>
<li><code>src/hardware_dep/$ARCH/data_plane</code>: code for the data plane</li>
<li><code>src/hardware_dep/$ARCH/ctrl_plane</code>: code for the control plane</li>
</ul></li>
</ul>
</body>
</html>
